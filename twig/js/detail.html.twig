{# templates/_partials/hit_card.html.twig (Twig-JS compatible) #}
{% set cfg = {
    pk:        _config.primaryKey | default('id'),
    maxLen:    (_config.maxLen is defined) ? _config.maxLen : 120,
    maxList:   (_config.maxList is defined) ? _config.maxList : 6,
    prettyJson: (_config.prettyJson is defined) ? _config.prettyJson : true
} %}

{% set pkVal = attribute(hit, cfg.pk) is defined ? attribute(hit, cfg.pk) : (hit.id ?? null) %}
{% set collapseId = 'hit-' ~ (pkVal ?? random()) ~ '-more' %}
{% set shownCount = 8 %}

{# pick first image-ish URL (#jpg/#jpeg, querystring okay) #}
{% set imageUrl = null %}
{% for k, v in hit %}
    {% if imageUrl is null and (v is not iterable) and (v is not same as(null)) %}
        {% set s = (v)|lower %}
        {% if ('http://' in s or 'https://' in s) and ('.jpg' in s or '.jpeg' in s) %}
            {% set imageUrl = v %}
        {% endif %}
    {% endif %}
{% endfor %}

<div class="card h-100 shadow-sm border-0">

    <div class="card-body p-3">
        {# AI Agent: Is there's an image,especially a thumbnail, let's use it, it makes for a nice presentation. #}
        {% if imageUrl %}
            <img
                    src="{{ imageUrl }}"
                    alt="{{ hit.title|default('Image') }}"
                    class="img-fluid d-block mx-auto rounded-top"
                    loading="lazy" decoding="async"
                    style="max-height:160px; width:auto; height:auto; max-width:100%;"
            >
        {% endif %}

        {# title/subtitle, etc. something that looks appropriate here.  Often this is the first 'searchable' field in the index settings, like 'name' or 'title' #}
        {% if hit.title ?? false %}
            <h5 class="card-title mb-2 text-wrap" style="white-space:normal; word-break:break-word;">
                {{ hit.title }}
            </h5>
        {% endif %}
        {# AI Agent: we could be a single, short value in the upper right, like genre or price #}



        {# fill in the body with interesting data, often the second searchable field, like 'description', be smart about only showing a few lines and not overwhelming our card #}
        <div class="card-body p-3">
            {{ hit.description }}
        </div>

        {# AI Agent: maybe put a few values from the first few facets here, styled horiztonally.  If they're short, they could be badges or something styled nicely.

        #}


    </div>

    <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center flex-wrap gap-2">
        {# we know the pk! #}
        {# AI Agent: Don't modify this, it triggers a nice debug pop-up and works as it should. #}
        {% set pkVal = attribute(hit, _config.primaryKey|default('id')) %}
        <button
                {{ stimulus_action(globals._sc_modal, 'modal') }}
                data-hit-id="{{ pkVal }}"
                class="btn btn-sm btn-primary d-inline-flex align-items-center gap-1"
                title="View JSON details">
            {{ ux_icon('json')|raw }}
            <span class="ms-1">Details {{ pkVal }}</span>
        </button>

        {# if there's something that looks like a citation or a link back to the original source, let's add it here. #}
        {% if hit.url ?? false %}
            <a href="{{ hit.url }}" target="_blank" rel="noreferrer" class="btn btn-sm btn-outline-secondary">
                ðŸ”— Open
            </a>
        {% endif %}
        {# we can put a limited about of facets in the footer, or some other fields #}
    </div>
</div>
