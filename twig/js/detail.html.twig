{# templates/_partials/hit_card.html.twig (Twig-JS compatible) #}
{% set cfg = {
    pk:        _config.primaryKey | default('id'),
    maxLen:    (_config.maxLen is defined) ? _config.maxLen : 120,
    maxList:   (_config.maxList is defined) ? _config.maxList : 6,
    prettyJson: (_config.prettyJson is defined) ? _config.prettyJson : true
} %}

{% set pkVal = attribute(hit, cfg.pk) is defined ? attribute(hit, cfg.pk) : (hit.id ?? null) %}
{% set collapseId = 'hit-' ~ (pkVal ?? random()) ~ '-more' %}
{% set shownCount = 8 %}

{# pick first image-ish URL (#jpg/#jpeg, querystring okay) #}
{% set imageUrl = null %}
{% for k, v in hit %}
    {% if imageUrl is null and (v is not iterable) and (v is not same as(null)) %}
        {% set s = (v)|lower %}
        {% if ('http://' in s or 'https://' in s) and ('.jpg' in s or '.jpeg' in s) %}
            {% set imageUrl = v %}
        {% endif %}
    {% endif %}
{% endfor %}

<div class="card h-100 shadow-sm border-0">

    <div class="card-body p-3">

        {% if imageUrl %}
            <img
                    src="{{ imageUrl }}"
                    alt="{{ hit.title|default('Image') }}"
                    class="img-fluid d-block mx-auto rounded-top"
                    loading="lazy" decoding="async"
                    style="max-height:160px; width:auto; height:auto; max-width:100%;"
            >
        {% endif %}

        {% if hit.title ?? false %}
            <h5 class="card-title mb-2 text-wrap" style="white-space:normal; word-break:break-word;">
                {{ hit.title }}
            </h5>
        {% endif %}

{#        <ul class="list-unstyled mb-0">#}
{#            #}{##}{# HEAD rows #}
{#            {% set rendered = 0 %}#}

{#            {% for var, val in hit %}#}
{#                {% if not (var starts with '_') and rendered < shownCount %}#}
{#                    {% set rendered = rendered + 1 %}#}

{#                    <li class="mb-2">#}
{#                        <div class="small text-muted mb-1" style="white-space:nowrap;">{{ var }}</div>#}

{#                        #}{##}{# SCALAR ------------------------------------------------------- #}
{#                        {% if val is not iterable %}#}
{#                            {% set s = (val is not same as(null)) ? (val) : '' %}#}
{#                            {% if s starts with 'http://' or s starts with 'https://' %}#}
{#                                <a href="{{ s }}" target="_blank" rel="noreferrer"#}
{#                                   class="link-body-emphasis d-inline-block text-wrap"#}
{#                                   style="white-space:normal; word-break:break-word;"#}
{#                                   title="{{ s }}">{{ s }}</a>#}
{#                            {% endif %}#}

{#                            #}{##}{# ITERABLE (list vs complex) ----------------------------------- #}
{#                        {% else %}#}
{#                        {% endif %}#}
{#                    </li>#}
{#                {% endif %}#}
{#            {% endfor %}#}
{#        </ul>#}

{#            <button class="btn btn-sm btn-outline-secondary mt-2"#}
{#                    type="button"#}
{#                    data-bs-toggle="collapse"#}
{#                    data-bs-target="#{{ collapseId }}"#}
{#                    aria-expanded="false"#}
{#                    aria-controls="{{ collapseId }}">#}
{#                Show more#}
{#            </button>#}
{#        {% endif %}#}
{#    </div>#}

{#    <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center flex-wrap gap-2">#}
{#        #}{# There will always be a primaryKey value #}
{#        {% set pkVal = attribute(hit, _config.primaryKey|default('id')) %}#}
{#        <button#}
{#                {{ stimulus_action(globals._sc_modal, 'modal') }}#}
{#                data-hit-id="{{ pkVal }}"#}
{#                class="btn btn-sm btn-primary d-inline-flex align-items-center gap-1"#}
{#                title="View JSON details">#}
{#            {{ ux_icon('json')|raw }}#}
{#            <span class="ms-1">Details {{ pkVal }}</span>#}
{#        </button>#}

{#        {% if hit.url ?? false %}#}
{#            <a href="{{ hit.url }}" target="_blank" rel="noreferrer" class="btn btn-sm btn-outline-secondary">#}
{#                ðŸ”— Open#}
{#            </a>#}
{#        {% endif %}#}
    </div>
</div>
